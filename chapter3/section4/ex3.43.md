交換プロセスが逐次的に実行されるとき、並行の残高交換を何回行ったとしても、口座残高は何らかの順番で 10 ドル、20 ドル、30 ドルである。なぜなら、各交換プロセスで、口座残高が何らかの順番で 10 ドル、20 ドル、30 ドルである前提は変わらず、それが逐次的に実行されるだけでからである。

次に、以下に示すこの章の最初のバージョンの口座交換プログラムを使用すると、この前提が破られることを示す。

プログラム：

```scheme
(define
  (exchange account1 account2)
  (let
    ( ;
     (difference
       (- (account1 'balance)
          (account2 'balance)
       )
     )
    )

    ((account1 'withdraw) difference)
    ((account2 'deposit) difference)
  )
)
```

口座 a に 20 ドル、b に 10 ドルあるとする。以下のような、これらの口座を交換するプロセスが 2 つ並行に実行されるとする。

- x1：a の残高を得る
- x2：b の残高を得る
- x3：difference を計算する
- x4：a から difference を減算する
- x5：b に difference を加算する

- y1：a の残高を得る
- y2：b の残高を得る
- y3：difference を計算する
- y4：a から difference を減算する
- y5：b に difference を加算する

これが以下の順番で実行されると、前述の前提が破られる（2 つの口座残高が何らかの順番で 10 ドル、20 ドルではなくなる）

1. x1：a の残高は 20 ドル
1. x2：b の残高は 10 ドル
1. x3：difference は 10 ドル
1. y1：a の残高は 20 ドル
1. y2：b の残高は 10 ドル
1. y3：difference は 10 ドル
1. x4：a から 10 ドルを減算する
1. y4：a から 10 ドルを減算する
1. x5：b に 10 ドルを加算する
1. y5：b に 10 ドルを加算する

結果として、口座 a に 0 ドル、b に 30 ドルある状態になってしまう。

一方、この交換プログラムを使用したとしても、口座全体の残高は保存される。なぜなら、預け入れと引き指しの処理が入れ違いになったとしても、account1 からの引き出しと account2 への預け入れが必ず同じ金額（difference）で相殺されるからである。

一方、個別の口座の取引を直列化しない場合、この前提まで破られる。

口座 a に 20 ドル、b に 10 ドルあるとする。以下のような、これらの口座を交換するプロセスが 2 つ並行に実行されるとする。

- x1：a の残高を得る
- x2：b の残高を得る
- x3：difference を計算する
- x4-1：a の残高を得る
- x4-2：x4-1 - x3 を計算する
- x4-3：a に x4-2 をセットする
- x5-1：b の残高を得る
- x5-2：x5-1 + x3 を計算する
- x5-3：b に x5-2 をセットする

- y1：a の残高を得る
- y2：b の残高を得る
- y3：difference を計算する
- y4-1：a の残高を得る
- y4-2：y4-1 - y3 を計算する
- y4-3：a に y4-2 をセットする
- y5-1：b の残高を得る
- y5-2：y5-1 + y3 を計算する
- y5-3：b に y5-2 をセットする

これが以下の順番で実行されると、前述の前提が破られる（口座残高の合計が保存されない）

1. x1：a の残高は 20 ドル
1. x2：b の残高は 10 ドル
1. x3：difference は 10 ドル
1. x4-1：a の残高は 20 ドル
1. x4-2：x4-1 - x3 は 10 ドル
1. x4-3：a に 10 ドルをセットする
1. y1：a の残高は 10 ドル
1. y2：b の残高は 10 ドル
1. y3：difference は 0 ドル
1. y4-1：a の残高は 10 ドル
1. y4-2：y4-1 - y3 は 10 ドル
1. y4-3：a に 10 ドルをセットする
1. y5-1：b の残高は 10 ドル
1. y5-2：y5-1 + y3 は 10 ドル
1. x5-1：b の残高は 10 ドル
1. x5-2：x5-1 + x3 は 20 ドル
1. x5-3：b に 20 ドルをセットする
1. y5-3：b に 10 ドルをセットする

結果として、口座 a には 10 ドル、b にも 10 ドルの残高となってしまった。
